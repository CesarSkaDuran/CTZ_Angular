<vex-page-layout @stagger>
  <vex-page-layout-content fxLayout="column">
    <div fxLayout="row" fxLayoutAlign="start center" class="mb-6">
      <h1 class="display-1 font-medium mt-4">Ingresos Diarios</h1>
    </div>
    <form fxLayout="column" fxFlex.gt-xs class="form-container" [formGroup]="filters">
      <div fxLayout="row" fxFlex.gt-xs fxLayout.xs="column" fxLayoutAlign="start center" 
        fxLayoutAlign.sm="start start" fxItemAlign="center" fxItemAlign.xs="start" fxLayoutGap="24px" fxLayoutGap.xs="12px">
        <mat-form-field appearance="outline" fxFlexAlign.xs="stretch" class="blue no-pad bold-form" floatLabel="always">
          <mat-label>Buscar</mat-label>
          <input matInput (keyup)="searchKeyUp($event)" (keyup.shift.n)="openIncomeModal()" #search
            placeholder="Id o Nombre..." formControlName="search" />
        </mat-form-field>
        <mat-form-field appearance="outline" fxFlexAlign.xs="stretch" class="blue no-pad bold-form" floatLabel="always">
          <mat-label>Fecha Inicial</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="date" placeholder="Rango de fecha"
            autocomplete="off" (dateChange)="dateChange($event)" />
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
        <mat-form-field appearance="outline" fxFlexAlign.xs="stretch" class="blue no-pad bold-form" floatLabel="always">
          <mat-label>Fecha Final</mat-label>
          <input matInput [matDatepicker]="picker2" formControlName="date2" placeholder="Rango de fecha"
            autocomplete="off" (dateChange)="dateChange($event)" />
          <mat-datepicker-toggle matSuffix [for]="picker2"></mat-datepicker-toggle>
          <mat-datepicker #picker2></mat-datepicker>
        </mat-form-field>
      </div>
      <p class="form-helper-text mt-3">Buscar por concepto o rango de fecha.</p>
    </form>
    <div fxLayout="row" fxLayoutAlign="start center" fxItemAlign="center" class="mb-9 mt-6">
      <h3 class="headline" fxFlex>Total: {{totalIncome | currency:'USD': 'symbol': '1.0'}}</h3>
      <button mat-flat-button color="primary" (click)="openIncomeModal()">NUEVO INGRESO</button>
    </div>
    <div class="card overflow-auto">
      <!-- table -->
      <table @stagger [dataSource]="data" class="w-full" (matSortChange)="sortRecords($event)" mat-table matSort>
        <!-- Code Column -->
        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha</th>
          <td mat-cell *matCellDef="let row" (click)="openIncomeModal(row)">
            <div fxLayout="column" fxLayoutAlign="center start">
              <span class="date text-secondary">{{ changeDateTimeFormat(row.date) }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Type Column -->
        <ng-container matColumnDef="concept">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Concepto</th>
          <td mat-cell *matCellDef="let row" (click)="openIncomeModal(row)" class="pl-0">
              {{row.concept}}
          </td>
        </ng-container>

        <!-- Type Column -->
        <ng-container matColumnDef="company">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Empresa</th>
          <td mat-cell *matCellDef="let row" (click)="openIncomeModal(row)" class="pl-0 text-secondary">
              {{row.company}}
          </td>
        </ng-container>

        <!-- Distribuitor Column -->
        <ng-container matColumnDef="value">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Valor</th>
          <td mat-cell *matCellDef="let row" (click)="openIncomeModal(row)" class="pl-0 text-blue-600">
            {{ row.value | currency:'USD': 'symbol': '1.0'}}
          </td>
        </ng-container>

        <!-- Symbol Column -->
        <ng-container matColumnDef="options">
          <th mat-header-cell *matHeaderCellDef>Opciones</th>
          <td mat-cell *matCellDef="let element" class="center no-pad">
            <button mat-icon-button [matMenuTriggerFor]="menu">
                <mat-icon [icIcon]="icMore"></mat-icon>
            </button>
            <mat-menu #menu="matMenu" class="row-menu">
              <button mat-menu-item (click)="openIncomeModal(element)">
                <mat-icon [icIcon]="icEdit"></mat-icon>
                <span>Editar</span>
              </button>
              <button mat-menu-item (click)="delete(element)" class="warning">
                <mat-icon [icIcon]="icRemove"></mat-icon>
                <span>Eliminar</span>
              </button>
            </mat-menu>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>

      <div [hidden]="data.length > 0" class="pt-9 pb-9">
        <div class="alternate-result">
          <div fxLayout="row" fxFlex fxLayoutAlign="center center">
            <div [hidden]="!loadingRecords">
              <div fxLayout="column" fxLayoutAlign="center center">
                <mat-spinner diameter="32"></mat-spinner>
                <span>CARGANDO</span>
              </div>
            </div>
            <div [hidden]="loadingRecords || data.length > 0">
              <div fxLayout="column" fxLayoutAlign="center center">
                <span class="text-secondary headline-1">NO HAY RESULTADOS</span>
                <span class="text-secondary headline-1">CREA UN NUEVO INGRESO</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <mat-paginator [length]="resultsLength" (page)="pageChange($event)" [pageSizeOptions]="pageSizeOptions"
        [pageSize]="pageSize" class="sticky left-0">
      </mat-paginator>
    </div>
  </vex-page-layout-content>


</vex-page-layout>
