<!-- <ng-keyboard-shortcuts [shortcuts]="shortcuts"></ng-keyboard-shortcuts> #} -->
<vex-page-layout @stagger>

  <vex-page-layout-content fxLayout="column">
    <div fxLayout="row" fxLayoutAlign="start center" class="mb-6">
      <h1 class="display-1 font-medium mt-4">Historias Clínicas</h1>
    </div>
    <form fxLayout="row" fxFlex.gt-xs fxLayout.xs="column" fxLayoutAlign="start center" 
        fxLayoutAlign.sm="start start" fxItemAlign="center" fxItemAlign.xs="start" fxLayoutGap="24px" fxLayoutGap.xs="12px" [formGroup]="filters">
        <mat-form-field appearance="outline" fxFlexAlign.xs="stretch" class="bold-form" floatLabel="always">
          <mat-label>Buscar</mat-label>
          <input matInput (keyup)="searchKeyUp($event)" (keyup.shift.n)="openPatientsModal()" #search
            placeholder="Id o Nombre..." formControlName="search" />
        </mat-form-field>
        <mat-form-field appearance="outline" fxFlexAlign.xs="stretch" class="bold-form " floatLabel="always">
          <mat-label>Fecha</mat-label>
          <input matInput [matDatepicker]="picker" formControlName="date" placeholder="Rango de fecha"
            autocomplete="off" (dateChange)="dateChange($event)" />
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
    </form>
    <div fxLayout="row" fxLayoutAlign="start center" fxItemAlign="center" class="mb-4 mt-2">
      <p class="body-1 text-grey-600 pr-4" fxFlex>Buscar por cualquier característica del paciente o de la historia clínica.</p>
      <button mat-flat-button color="primary" (click)="openPatientsModal()">NUEVA HISTORIA</button>
    </div>
    <div class="card overflow-auto">
      <table @stagger [dataSource]="dataSource" class="w-full" (matSortChange)="sortRecords($event)" mat-table matSort>

        <!--- Note that these columns can be defined in any order.
            The actual rendered columns are set as a property on the row definition" -->
          <!-- Code Column -->
        <ng-container matColumnDef="id">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>ID</th>
          <td mat-cell *matCellDef="let row">
            <div fxLayout="column" fxLayoutAlign="center start">
              <span class="id">{{ row.identification }}</span>
              <span class="text-cyan">{{ changeDateTimeFormat(row.created_at) }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Type Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Nombre</th>
          <td mat-cell *matCellDef="let row" class="pl-0">
            <div fxLayout="column" fxLayoutAlign="center start">
              <span>{{ row.patient ? row.patient.name : '' }}</span>
              <span class="text-blue">{{ row.patient ? row.patient.position : '' }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Distribuitor Column -->
        <ng-container matColumnDef="phone">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Teléfono</th>
          <td mat-cell *matCellDef="let row" class="pl-0 text-secondary">
            {{ row.patient ? row.patient.phone : '' }}
          </td>
        </ng-container>

        <!-- Distribuitor Column -->
        <ng-container matColumnDef="company">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Empresa</th>
          <td mat-cell *matCellDef="let row" class="pl-0 text-secondary">
            {{ row.patient ? row.patient.company : '' }}
          </td>
        </ng-container>

        <!-- Buy date Column -->
        <ng-container matColumnDef="created_at">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Ingreso</th>
          <td mat-cell *matCellDef="let row" class="pl-0 text-secondary">
            {{ row.created_at }}
          </td>
        </ng-container>        

        <tr *matHeaderRowDef="displayedColumns" mat-header-row></tr>
        <tr @fadeInUp *matRowDef="let row; columns: displayedColumns;"
          class="hover:bg-hover swift-ease-out cursor-pointer" (click)="selectRecord(row)" mat-row></tr>
      </table>

      <div [hidden]="data.length > 0" class="pt-24 pb-24">
        <div class="alternate-result">
          <div fxLayout="row" fxFlex fxLayoutAlign="center center">
            <div [hidden]="!loadingRecords">
              <div fxLayout="column" fxLayoutAlign="center center">
                <mat-spinner diameter="32"></mat-spinner>
                <span>CARGANDO</span>
              </div>
            </div>
            <div [hidden]="loadingRecords || data.length > 0">
              <div fxLayout="column" fxLayoutAlign="center center">
                <span class="text-secondary headline-1">NO HAY RESULTADOS</span>
                <span class="text-secondary headline-1">CREA UN NUEVA HISTORIA</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <mat-paginator [length]="resultsLength" (page)="pageChange($event)" [pageSizeOptions]="pageSizeOptions"
        [pageSize]="pageSize" class="sticky left-0">
      </mat-paginator>
    </div>
  </vex-page-layout-content>


</vex-page-layout>
